{"name":"RESTful API Authentication","body":"With most RESTful Web API's, it is important to know which app is using your resources and that only the apps you allow access those resources. This gem allows you to easily add this layer of authentication to any Rails RESTful resource you want, and it even includes protection against various forms of attack.\r\n\r\nGo here to read a more lengthy description of the problem this gem is attempting to solve: [Authentication of a Ruby on Rails RESTful Web API / Service](http://www.djkiger.com/?p=41)\r\n\r\n## Requirements\r\n\r\n1. Rails 3.2.0+\r\n2. ActiveRecord database (sqlite, MySQL, etc.)\r\n\r\n## Dependencies\r\n\r\n1. Rails 3.2.0+\r\n2. UUID Gem 2.3.5+\r\n3. Chronic Gem 0.6.7+\r\n\r\n## Installation\r\n\r\nAdd this line to your application's Gemfile:\r\n\r\n    gem 'restful_api_authentication'\r\n\r\nAnd then execute:\r\n\r\n    $ bundle\r\n\r\nOr install it yourself as:\r\n\r\n    $ gem install restful_api_authentication\r\n\r\nRun Rails generator:\r\n\r\n    $ rails g restful_api_authentication:install\r\n\r\nRun the migration task:\r\n\r\n    $ rake db:migrate\r\n\r\nUpdate the configuration (if you like) by editing the `config/restful_api_authentication.yml` file.\r\n\r\n## Usage\r\n\r\n### How It Works From A Client's Perspective\r\n\r\nBefore anyone can use a resource which is protected using this gem, that person/app must have a valid API key and secret. These are generated and stored as a RestClient model in your app. The easiest way to generate this is to use the Rails console:\r\n\r\n```ruby\r\nnew_app = RestClient.create(:name => \"My New App\", :description => \"This is my new application that will access my RESTful API.\")\r\nnew_app.api_key\r\nnew_app.secret\r\n```\r\n\r\nIn order to authenticate with your web service, the new application must include the following HTTP headers with each request:\r\n* x-timestamp\r\n* x-api-key\r\n* x-signature\r\n\r\nThe x-timestamp should be the date and time the request is sent. It should be in UTC time and be formatted as \"YYYY-MM-DD HH:MM:SS UTC\". For example: `2012-03-31 15:37:32 UTC`\r\n\r\nThe x-api-key should be the same as the API key generated above. It should look something like `0f0721f0-5cc9-012f-c884-68a86d3dfd0`.\r\n\r\nThe x-signature is generated by concatenating the secret generated above, the API request URL, and the x-timestamp into a single string and then using the SHA256 hash algorithm to generate a hash of this string. The x-signature is this hash.\r\n\r\nHere is an example in Ruby code using the HTTParty gem:\r\n\r\n```ruby\r\nrequire 'httparty'\r\nrequire 'digest/sha2'\r\n\r\nclass MyTestApi\r\n  include HTTParty\r\n\r\n  API_KEY = \"e4a80df0-5cca-012f-c884-68a86d3dfd02\"\r\n  SECRET = \"473287f8298dba7163a897908958f7c0eae733e25d2e027992ea2edc9bed2fa8\"\r\n  \r\n  def auth_headers(request_uri)\r\n    timestamp = Time.now.utc.strftime \"%Y-%m-%d %H:%M:%S UTC\"\r\n    signature_string = SECRET + request_uri + timestamp\r\n    digest = Digest::SHA256.new << signature_string\r\n    signature = digest.to_s\r\n    { \"x-api-key\" => API_KEY, \"x-timestamp\" => timestamp, \"x-signature\" => signature }\r\n  end\r\n  \r\n  def authenticate_test\r\n    request_uri = \"https://api.mywebservice.com/help/authenticate\"\r\n    self.class.post(request_uri, { :headers => auth_headers(request_uri) })\r\n  end\r\n\r\nend\r\n\r\napi = MyTestApi.new\r\nresult = api.authenticate_test\r\nputs result.inspect\r\n```\r\n\r\n### Configuration\r\n\r\nIn the `config/restful_api_authentication.yml` file you will find several things that you can change. The defaults are usually fine for most cases.\r\n\r\n**Verbose Error Messages (>= 0.2.0)**\r\n\r\nBy default, the standard response to any authentication error is \"not authorized\". However, more meaningful explanations of why authentication is failing can be sent by adding the following to the `config/restful_api_authentication.yml` file:\r\n\r\n```\r\nverbose_errors: true\r\n```\r\n\r\n### Requiring Authentication\r\n\r\nTo require authentication for a specific resource (controller) of your RESTful web service, add this at the top of your controller just under where you open the controller class:\r\n\r\n```ruby\r\ninclude RestfulApiAuthentication\r\nrespond_to :json, :xml\r\nbefore_filter :authenticated?\r\n```\r\n\r\nIf you want to protect your entire web service, add those same lines to your ApplicationController class.\r\n\r\nIf the headers are not provided or the application fails to authenticate, your web service will deliver a 401 Unauthorized response.\r\n\r\n### Master Authentication\r\n\r\nSome web services might require an extra bit of security (creating new RestClients or managing User records). In these cases, you can require \"master\" authorization. Then, any RestClient with the is_master attribute set to true can use the resources but the others cannot.\r\n\r\nAssuming you have authentication setup in your application controller, in the controller that requires master authentication:\r\n\r\n```ruby\r\nskip_before_filter :authenticated?\r\nbefore_filter :authenticated_master?\r\n```\r\n\r\n## Contributing\r\n\r\n1. Fork it\r\n2. Create your feature branch (`git checkout -b my-new-feature`)\r\n3. Commit your changes (`git commit -am 'Added some feature'`)\r\n4. Push to the branch (`git push origin my-new-feature`)\r\n5. Create new Pull Request\r\n","tagline":"A gem which implements a standard api_key / secret authentication system for your Ruby on Rails RESTful web services.","google":"UA-20285212-2","note":"Don't delete this file! It's used internally to help with page regeneration."}